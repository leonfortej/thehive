# Example Docker Compose Configuration for Cortex with Custom Analyzers
# This is a reference example - merge with your existing docker-compose.yml

version: '3.8'

services:
  cortex:
    image: strangebee/cortex:latest
    container_name: cortex
    depends_on:
      - elasticsearch
    ports:
      - "9001:9001"
    volumes:
      # Docker socket access (required for Docker-based analyzers)
      - /var/run/docker.sock:/var/run/docker.sock

      # Job files directory (shared between Cortex and analyzers)
      - cortex-jobs:/tmp/cortex-jobs
      - /var/run/cortex/jobs:/tmp/cortex-jobs

      # Custom analyzers and responders from local directory (READ-ONLY)
      - C:/AI Projects/SOC-Automation/02-TheHive-Cortex/analyzers:/opt/CustomAnalyzers:ro

      # Custom Cortex configuration
      - /opt/cortex/application.conf:/etc/cortex/application.conf:ro

    environment:
      # Job directory configuration
      - job_directory=/tmp/cortex-jobs
      - docker_job_directory=/var/run/cortex/jobs

      # Elasticsearch connection
      - CORTEX_ELASTICSEARCH_HOSTS=elasticsearch:9200

    networks:
      - thehive-network

  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.17.9
    container_name: elasticsearch
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    volumes:
      - elasticsearch-data:/usr/share/elasticsearch/data
    networks:
      - thehive-network

volumes:
  cortex-jobs:
    driver: local
  elasticsearch-data:
    driver: local

networks:
  thehive-network:
    driver: bridge
